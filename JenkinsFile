stageResultMap = [:]
pipeline {

    agent any
    
    stages {
		

		stage('Installing Packages'){

			
			steps{

				echo '************** Installing requirements ************************'
				sh 'pip install -r requirements.txt'
				sh 'exit 0'
				
			}
			
			script{
				stageResultMap.Stage1 = currentBuild.currentResult
				echo 'stageResultMap.find{ it.key == "Stage1" }?.value'
			}

		}

		stage('Static Code Checking') {
			when {
              			expression {
                		currentBuild.currentResult == 'SUCCESS' 
              			}
			}
            steps {
                script {
                    sh 'find . -name \\*.py | xargs pylint -f parseable | tee pylint.log'
                }
            }
        }

 		stage('Test') {
		
			when {
              			expression {
                		currentBuild.currentResult == 'SUCCESS' || currentBuild.currentResult == 'FAILURE' ||  currentBuild.currentResult == 'UNSTABLE'
              			}
			}
		
			steps {
				
				echo '******************* Test Msg **********************************'
				sh 'pytest'
			}
		}  
		
		stage('Deploy'){
		
			when {
              			expression {
                		currentBuild.currentResult == 'SUCCESS' 
              			}
			}
		    steps {
			script {
			    sh 'find . -name \\*.py | xargs pylint -f parseable | tee pylint.log'
			}
            }
		
			
		}
    		
    }
}
